<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TimeTrackly</title>

	<!--
		TimeTrackly
		===========

		ARCHITECTURE OVERVIEW:
		This is a single-page application (SPA) for local time tracking. It operates
		entirely in the browser with a local Node.js server providing data persistence.

		DESIGN PHILOSOPHY - Single-User, Local-First:
		- No authentication or user accounts
		- All data stored locally in JSON files
		- Complete privacy (no external network requests except CDNs)
		- Survives browser/system restarts via server-side state persistence

		MODULAR STRUCTURE:
		The application uses ES6 modules for clean separation of concerns:
		- app.js: Main orchestrator, initializes everything
		- state.js: Centralized state management
		- api.js: Server communication layer
		- ui.js: DOM manipulation and user interactions
		- reports.js: Chart generation and analytics
		- utils.js: Shared utility functions
		- constants.js: Configuration values

		UI ORGANIZATION:
		The interface uses collapsible sections to reduce visual clutter:
		- Start New Timer: Collapsed by default (indigo background)
		- Active Timers: Expanded by default (green background)
		- Data Export: Collapsed by default (gray background)
		All sections have smooth animations with rotating chevron icons.

		NOTES FEATURE:
		Each timer includes a Notes button that opens a floating modal dialog:
		- Click Notes button on any timer row
		- Modal displays "Notes for <Task Name>"
		- Explicit Save button required (or cancel/ESC to discard)
		- Close with: Save button, Cancel, ESC key, or click backdrop
		- Notes persist when saved, included in CSV exports
		- Empty notes stored as empty strings

		EXTERNAL DEPENDENCIES (CDN):
		- Tailwind CSS: Utility-first CSS framework for styling
		- Chart.js: Canvas-based charts for reports
		- Google Fonts (Inter): Typography

		IMPACT OF CHANGES:
		- Changing script type from "module" will break ES6 imports
		- Removing/changing CDN URLs will break styling or charts
		- DOM element IDs are referenced in ui.js - changing them breaks functionality

		MAINTAINABILITY:
		- Keep this HTML minimal - business logic belongs in JS modules
		- New features should add modules, not inline scripts
		- DOM structure changes require corresponding updates in ui.js
	-->

	<!-- Load Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>
	<!-- Load Chart.js for Visualization -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
	<!-- Material Icons -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!-- Configure Font -->
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

		body {
			font-family: 'Roboto', sans-serif;
		}

		/* Material Design Elevation Shadows */
		.elevation-1 {
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
		}

		.elevation-2 {
			box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
		}

		.elevation-3 {
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
		}

		.elevation-4 {
			box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
		}

		/* Google Brand Colors */
		.google-blue {
			background-color: #4285F4;
		}

		.google-red {
			background-color: #EA4335;
		}

		.google-yellow {
			background-color: #FBBC04;
		}

		.google-green {
			background-color: #34A853;
		}

		/* Button Ripple Effect */
		.btn-ripple {
			position: relative;
			overflow: hidden;
			transform: translate3d(0, 0, 0);
		}

		.btn-ripple:after {
			content: "";
			display: block;
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			pointer-events: none;
			background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
			background-repeat: no-repeat;
			background-position: 50%;
			transform: scale(10, 10);
			opacity: 0;
			transition: transform .5s, opacity 1s;
		}

		.btn-ripple:active:after {
			transform: scale(0, 0);
			opacity: .3;
			transition: 0s;
		}

		.rotate-90 {
			transform: rotate(90deg);
		}

		.paused-card {
			border-left: 4px solid #FBBC04;
			/* Google Yellow */
		}

		.tab-button {
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.tab-button.active {
			border-bottom: 3px solid #4285F4;
			/* Google Blue */
			color: #202124;
			font-weight: 500;
		}

		/* Timer Card */
		.timer-card {
			transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.timer-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
		}

		/* Material Design Button States */
		.md-button {
			transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
			text-transform: uppercase;
			letter-spacing: 0.5px;
			font-weight: 500;
		}

		.md-button:hover:not(:disabled) {
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			transform: translateY(-1px);
		}

		.md-button:active:not(:disabled) {
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
			transform: translateY(0);
		}

	/* Material Design Input Field Focus State */
	.material-input:focus {
		border-width: 2px;
		border-color: #4285F4;
		box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
	}

	/* Task Row Status Indicator Bar */
	.task-row-active {
		border-left: 4px solid #4285F4;
		/* Google Blue for active tasks */
	}

	.task-row-paused {
		border-left: 4px solid #FBBC04;
		/* Google Yellow for paused tasks */
	}

	/* Button Container - Always Visible */
	.action-buttons {
		transition: all 0.2s ease-in-out;
	}

	/* Project Header Hover Effect */
	.project-header {
		transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.project-header:hover {
		background-color: #e5e7eb;
	}

	/* Enhanced Material Design Focus Ring */
	.material-textarea:focus {
		border-color: #4285F4;
		box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
	}

	/* STEP 1 & 4: Compact Task Row Styles */
	.task-row {
		transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.task-row:hover {
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
	}

	/* Status indicator circle */
	.status-indicator {
		transition: transform 0.2s ease;
	}

	.task-row:hover .status-indicator {
		transform: scale(1.3);
	}

	/* STEP 2: Notes container (visible by default) */
	.task-notes-container {
		background-color: #F9FAFB;
		border-top: 1px solid #E5E7EB;
		border-bottom: 1px solid #E5E7EB;
	}

	.task-notes-container textarea {
		background-color: white;
		border: 1px solid #D1D5DB;
	}

	.task-notes-container textarea:focus {
		background-color: white;
	}

	/* STEP 3: Notes badge styling */
	.notes-badge {
		cursor: pointer;
		display: inline-block;
	}

	.notes-badge:hover {
		transform: scale(1.2);
		transition: transform 0.15s ease;
	}

	/* STEP 4: Action buttons hover behavior */
	.group:hover .action-buttons {
		animation: fadeIn 0.15s ease-in;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}

	/* STEP 6: Scannability - Duration alignment and visual hierarchy */
	.duration {
		letter-spacing: 0.5px;
		min-width: 5rem;
	}

	/* Ensure all durations align vertically for quick scanning */
	.task-row .duration {
		text-align: right;
		font-weight: 500;
		color: #374151;
	}

	/* Project header visual distinction */
	.project-header {
		border-left: 4px solid #4F46E5;
		/* Indigo border for strong visual separation */
		padding-left: 12px;
	}

	/* Task row - subtle visual separator */
	.task-row {
		border-top: 1px solid transparent;
		border-bottom: 1px solid transparent;
	}

	.task-row:hover {
		border-bottom-color: #E5E7EB;
	}

	/* STEP 5: Project-level action buttons */
	.project-action-btn {
		opacity: 0;
		transition: all 0.2s ease;
		margin-left: auto;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		min-width: 32px;
		min-height: 32px;
		border-radius: 50%;
		background-color: transparent;
		color: #666;
		border: none;
		cursor: pointer;
		font-size: 18px;
	}

	.project-header:hover .project-action-btn {
		opacity: 1;
	}

	.project-action-btn:hover {
		background-color: rgba(79, 70, 229, 0.1);
		color: #4F46E5;
		transform: scale(1.15);
	}

	/* Modal Styling */
	.modal-backdrop {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background-color: rgba(0, 0, 0, 0.5);
		z-index: 40;
		animation: fadeIn 0.15s ease-in;
	}

	.modal-backdrop.active {
		display: block;
	}

	.modal-dialog {
		display: none;
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%) scale(0.95);
		background: white;
		border-radius: 12px;
		box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
		z-index: 50;
		max-width: 500px;
		width: 90%;
		max-height: 70vh;
		flex-direction: column;
		animation: slideUp 0.2s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.modal-dialog.active {
		display: flex;
	}

	@keyframes slideUp {
		from {
			opacity: 0;
			transform: translate(-50%, -45%) scale(0.95);
		}
		to {
			opacity: 1;
			transform: translate(-50%, -50%) scale(1);
		}
	}

	.modal-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 20px;
		border-bottom: 1px solid #E5E7EB;
		flex-shrink: 0;
	}

	.modal-title {
		font-size: 18px;
		font-weight: 600;
		color: #202124;
		margin: 0;
	}

	.modal-close-btn {
		background: none;
		border: none;
		color: #6B7280;
		cursor: pointer;
		font-size: 24px;
		padding: 0;
		width: 32px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 6px;
		transition: all 0.2s ease;
	}

	.modal-close-btn:hover {
		background-color: #F3F4F6;
		color: #202124;
	}

	.modal-body {
		padding: 20px;
		overflow-y: auto;
		flex: 1;
	}

	.modal-body textarea {
		width: 100%;
		padding: 12px;
		border: 1px solid #D1D5DB;
		border-radius: 8px;
		font-family: inherit;
		font-size: 14px;
		resize: vertical;
		min-height: 150px;
		transition: all 0.2s ease;
	}

	.modal-body textarea:focus {
		outline: none;
		border-color: #4285F4;
		box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
	}

	.modal-footer {
		padding: 16px 20px;
		border-top: 1px solid #E5E7EB;
		display: flex;
		justify-content: flex-end;
		gap: 8px;
		flex-shrink: 0;
	}

	.modal-footer-btn {
		padding: 8px 16px;
		border-radius: 6px;
		border: none;
		cursor: pointer;
		font-size: 14px;
		font-weight: 500;
		transition: all 0.2s ease;
	}

	.modal-footer-btn.primary {
		background-color: #4285F4;
		color: white;
	}

	.modal-footer-btn.primary:hover {
		background-color: #357ABD;
		box-shadow: 0 4px 8px rgba(66, 133, 244, 0.2);
	}

	.modal-footer-btn.secondary {
		background-color: #F3F4F6;
		color: #202124;
	}

	.modal-footer-btn.secondary:hover {
		background-color: #E5E7EB;
	}
	</style>
</head>

<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

	<div id="app" class="max-w-5xl mx-auto bg-white elevation-4 rounded-2xl p-8 sm:p-12">
		<h1 class="text-4xl font-light text-gray-900 mb-8 text-center tracking-tight">Time Trackly</h1>

		<!-- Tab Navigation -->
		<div class="flex border-b-2 border-gray-200 mb-8">
			<button id="tab-tracker" data-tab="tracker"
				class="tab-button active flex-1 py-4 text-center text-gray-500 hover:text-gray-900 text-base">
				<span class="material-icons align-middle mr-2 text-xl">schedule</span>
				Create & Track Tasks
			</button>
			<button id="tab-reports" data-tab="reports"
				class="tab-button flex-1 py-4 text-center text-gray-500 hover:text-gray-900 text-base">
				<span class="material-icons align-middle mr-2 text-xl">analytics</span>
				Anayze Time Reports
			</button>
		</div>

		<!-- Content Views -->
		<div id="view-tracker" class="content-view">
			<!-- Data Entry Section -->
			<div class="mb-8">
				<div id="data-entry-header"
					class="flex justify-between items-center p-4 google-blue text-white cursor-pointer rounded-t-xl elevation-2 hover:elevation-3 font-medium mb-0">
					<div class="flex items-center space-x-3">
						<span id="icon-data-entry" class="material-icons transition-transform duration-200">chevron_right</span>
						<span class="text-lg">Start New Timer</span>
					</div>
				</div>
				<div id="data-entry-content"
					class="transition-all duration-300 ease-in-out overflow-hidden h-0 bg-blue-50 rounded-b-xl elevation-1">
					<div class="p-6">
						<p class="text-sm text-gray-600 mb-4 text-center">Format: <span
								class="font-mono bg-white px-2 py-1 rounded-md elevation-1">Project / Task</span></p>

						<!-- Smart Activity Input with Datalist -->
						<div class="flex flex-col sm:flex-row gap-4 mb-4">
							<div class="flex-grow relative">
								<span class="material-icons absolute left-3 top-3.5 text-gray-400">work</span>
								<input list="activity-suggestions" type="text" id="topic-input"
									placeholder="Enter Project / Task or select from suggestions"
									class="w-full pl-12 pr-4 py-3 border border-gray-400 rounded-lg text-base focus:outline-none material-input transition">
								<datalist id="activity-suggestions"></datalist>
							</div>

							<button id="start-button"
								class="w-full sm:w-40 flex-shrink-0 text-white md-button btn-ripple py-3 px-6 rounded-lg google-blue hover:opacity-90 elevation-2 disabled:bg-gray-400 disabled:cursor-not-allowed">
								<span class="material-icons align-middle mr-1 text-xl">play_arrow</span>
								Start
							</button>
						</div>

						<p id="error-message" class="text-sm text-red-600 mb-2 min-h-[20px] flex items-center"></p>
					</div>
				</div>
			</div>

			<!-- Active Timers Display -->
			<div class="mb-8">
				<div id="active-timers-header"
					class="flex justify-between items-center p-4 google-green text-white cursor-pointer rounded-t-xl elevation-2 hover:elevation-3 font-medium mb-0">
					<div class="flex items-center space-x-3">
						<span id="icon-active-timers"
							class="material-icons rotate-90 transition-transform duration-200">chevron_right</span>
						<span class="text-lg">Active Timers (<span id="active-count">0</span>)</span>
					</div>
				</div>
				<div id="active-timers-content"
					class="transition-all duration-300 ease-in-out overflow-hidden bg-green-50 rounded-b-xl elevation-1"
					style="height: auto;">
					<div id="active-timers-list" class="space-y-4 p-6 min-h-[120px]">
						<div id="no-active-message" class="text-gray-500 text-center py-8 flex flex-col items-center">
							<span class="material-icons text-5xl text-gray-300 mb-3">timer_off</span>
							<p>No tasks currently running</p>
						</div>
					</div>
				</div>
			</div>

			<!-- Data Export Section -->
			<div class="mt-8">
				<div id="data-export-header"
					class="flex justify-between items-center p-4 bg-gray-600 text-white cursor-pointer rounded-t-xl elevation-2 hover:elevation-3 font-medium mb-0">
					<div class="flex items-center space-x-3">
						<span id="icon-data-export" class="material-icons transition-transform duration-200">chevron_right</span>
						<span class="text-lg">Data Export</span>
					</div>
				</div>
				<div id="data-export-content"
					class="transition-all duration-300 ease-in-out overflow-hidden h-0 bg-gray-50 rounded-b-xl elevation-1">
					<div class="p-6">
						<button id="export-button"
							class="w-full bg-gray-700 text-white md-button btn-ripple py-3 px-6 rounded-lg hover:bg-gray-800 elevation-2">
							<span class="material-icons align-middle mr-2">download</span>
							Export All Data (CSV)
						</button>
					</div>
				</div>
			</div>
		</div>

		<div id="view-reports" class="content-view hidden">
			<div id="reports-loading" class="text-center text-gray-500 py-12">Loading historical data...</div>
			<div id="reports-error" class="text-center text-red-500 py-12 hidden">Error loading reports. Check console.</div>

			<div id="reports-content" class="space-y-12 hidden">
				<h3 class="text-2xl font-semibold text-gray-700 border-b pb-2">Time Distribution by Project</h3>
				<div class="flex justify-center h-80">
					<canvas id="project-pie-chart"></canvas>
				</div>

				<h3 class="text-2xl font-semibold text-gray-700 border-b pb-2 pt-6">Daily Time Logged (Last 7 Days)</h3>
				<div class="h-80">
					<canvas id="daily-bar-chart"></canvas>
				</div>
			</div>
		</div>

		<!-- Status and ID Display -->
		<p class="text-sm text-center text-gray-400 mt-6" id="user-id-display">User ID: Loading...</p>
	</div>

	<!-- Notes Modal -->
	<div id="notes-modal-backdrop" class="modal-backdrop"></div>
	<div id="notes-modal" class="modal-dialog">
		<div class="modal-header">
			<h2 id="notes-modal-title" class="modal-title">Notes</h2>
			<button id="notes-modal-close" class="modal-close-btn" aria-label="Close modal">
				<span class="material-icons">close</span>
			</button>
		</div>
		<div class="modal-body">
			<textarea id="notes-modal-textarea" placeholder="Add notes..."></textarea>
		</div>
		<div class="modal-footer">
			<button id="notes-modal-cancel" class="modal-footer-btn secondary">Cancel</button>
			<button id="notes-modal-save" class="modal-footer-btn primary">Save</button>
		</div>
	</div>

	<!--
		ES6 Module Entry Point
		======================
		CRITICAL: type="module" enables ES6 import/export syntax.

		Loading app.js kicks off the entire application:
		1. Loads all other modules via imports
		2. Fetches data from server
		3. Initializes UI
		4. Sets up event listeners

		IMPACT: Removing type="module" or changing src path breaks the entire app.
		The server must serve this with proper MIME type (application/javascript).
	-->
	<script type="module" src="js/app.js"></script>
</body>

</html>
